function _(string){var translated_string=string;if(typeof lang!=="undefined"&&lang[string]){translated_string=lang[string]}if(arguments.length>1){for(var i=1;i<arguments.length;i++){var param="%"+i;translated_string=translated_string.replace(param,arguments[i])}}return translated_string}function isNumberKey(evt){var charCode=evt.which?evt.which:typeof"event"!="undefined"?event.keyCode:32;if(charCode>31&&(charCode<48||charCode>57)){return false}return true}function validEmail(email){var filter=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return filter.test(email)}function validTelephone(telephone){telephone=telephone.replace(/[^\d]/,"");telephone=telephone.replace(/\s+/g,"");var filter=/^(004|04|4)?0[237]{1}\d{8}$/;return filter.test(telephone)}function checkValid(id,message,rule,value){if(rule!="radio"&&!isID(id)){return""}var prefix="* ";var suffix="\n";switch(rule){case"required":if(document.getElementById(id).value.trim()==""){return prefix+message+suffix}break;case"select":if(document.getElementById(id).options[document.getElementById(id).selectedIndex].value==""){return prefix+message+suffix}break;case"select_not_default":if(document.getElementById(id).options[document.getElementById(id).selectedIndex].value=="--")return prefix+message+suffix;break;case"radio":found=false;jQuery("input:radio[name='"+id+"']").each(function(){if(jQuery(this).is(":checked")){found=true}});if(!found){return prefix+message+suffix}break;case"checkbox":found=false;jQuery("input:checkbox[name='"+id+"']").each(function(){if(jQuery(this).is(":checked")){found=true}});if(!found){return prefix+message+suffix}break;case"numeric":var validch="0123456789.-";var isNumber=true;var ch;var val=document.getElementById(id).value;for(i=0;i<val.length&&isNumber==true;i++){ch=val.charAt(i);if(validch.indexOf(ch)==-1){return prefix+message+suffix}}break;case"alpha":var filter=/^[a-zA-Z]+$/;if(!filter.test(document.getElementById(id).value)){return prefix+message+suffix}break;case"email":if(!validEmail(document.getElementById(id).value)){return prefix+message+suffix}break;case"email_multiple":var arr=document.getElementById(id).value.split("\n");for(i=0;i<arr.length;i++){if(!validEmail(arr[i])){return prefix+message+suffix}}break;case"float":var filter=/^((\d+(\.\d*)?)|((\d*\.)?\d+))$/;if(!filter.test(document.getElementById(id).value)){return prefix+message+suffix}break;case"telephone":if(!validTelephone(document.getElementById(id).value)){return prefix+message+suffix}break;case"integer":var validch="0123456789";var isNumber=true;var ch;var val=document.getElementById(id).value;for(i=0;i<val.length&&isNumber==true;i++){ch=val.charAt(i);if(validch.indexOf(ch)==-1){return prefix+message+suffix}}break;case"limitpercent":if(document.getElementById(id).value<0||document.getElementById(id).value>100){return prefix+message+suffix}break;case"notzero":if(!document.getElementById(id)||document.getElementById(id).value==0){return prefix+message+suffix}break;case"date":message=isDate(document.getElementById(id).value);if(message!="0"){return prefix+message+suffix}break;case"lessthan":if(document.getElementById(id).value>value){return prefix+message+suffix}break;case"length":if(document.getElementById(id).value.toString().length!=value){return prefix+message+suffix}break;case"minlength":if(document.getElementById(id).value.toString().length<value){return prefix+message+suffix}break;case"maxlength":if(document.getElementById(id).value.toString().length>=value){return prefix+message+suffix}break;case"hasrows":if(document.getElementById(id).tBodies[0].rows.length<value){return prefix+message+suffix}break;case"color":if(document.getElementById(id).value.toString().length>0){var color=new RGBColor(document.getElementById(id).value.toString());if(!color.ok){return prefix+message+suffix}}break;case"cnp":cnp=document.getElementById(id).value;if(cnp.length==6&&cnp.substr(0,2)=="00"){return""}if(cnp.length!=13){return prefix+message+suffix}s=parseInt(cnp.charAt(0))*2+parseInt(cnp.charAt(1))*7+parseInt(cnp.charAt(2))*9+parseInt(cnp.charAt(3))*1+parseInt(cnp.charAt(4))*4+parseInt(cnp.charAt(5))*6+parseInt(cnp.charAt(6))*3+parseInt(cnp.charAt(7))*5+parseInt(cnp.charAt(8))*8+parseInt(cnp.charAt(9))*2+parseInt(cnp.charAt(10))*7+parseInt(cnp.charAt(11))*9;checkbit=s%11;if(checkbit==10){checkbit=1}if(parseInt(cnp.charAt(12))!=checkbit){return prefix+message+suffix}break}return""}function modalValid(id,message,rule,value){var e=checkValid(id,message,rule,value);if(e!=""){if(!document.getElementById("modal_err_"+id)){if(rule=="radio"){jQuery("input:radio[name='"+id+"']").parent().append('<span class="form_error" id="modal_err_'+id+'">'+message+"</span>");jQuery("input:radio[name='"+id+"']").click(function(){removeError(id,"modal_")})}else if(rule=="checkbox"){jQuery("input:checkbox[name='"+id+"']").parent().append('<span class="form_error" id="modal_err_'+id+'">'+message+"</span>");jQuery("input:checkbox[name='"+id+"']").click(function(){removeError(id,"modal_")})}else{jQuery("#"+id).parent().append('<span class="form_error" id="modal_err_'+id+'">'+message+"</span>");jQuery("#"+id).css("backgroundColor","#FEFFB1");tagName=document.getElementById(id).tagName.toLowerCase();switch(tagName){case"input":case"textarea":jQuery("#"+id).keyup(function(){removeError(id,"modal_")});break;case"select":jQuery("#"+id).change(function(){removeError(id,"modal_")});break;default:break}}}return false}return true}function serialize(inp){var getType=function(inp){var type=typeof inp,match;if(type=="object"&&!inp){return"null"}if(type=="object"){if(!inp.constructor){return"object"}var cons=inp.constructor.toString();if(match=cons.match(/(\w+)\(/)){cons=match[1].toLowerCase()}var types=["boolean","number","string","array"];for(key in types){if(cons==types[key]){type=types[key];break}}}return type};var type=getType(inp);var val;switch(type){case"undefined":val="N";break;case"boolean":val="b:"+(inp?"1":"0");break;case"number":val=(Math.round(inp)==inp?"i":"d")+":"+inp;break;case"string":val="s:"+inp.length+':"'+inp+'"';break;case"array":val="a";case"object":if(type=="object"){var objname=inp.constructor.toString().match(/(\w+)\(\)/);if(objname==undefined){return}objname[1]=serialize(objname[1]);val="O"+objname[1].substring(1,objname[1].length-1)}var count=0;var vals="";var okey;for(key in inp){okey=key.match(/^[0-9]+$/)?parseInt(key):key;vals+=serialize(okey)+serialize(inp[key]);count++}val+=":"+count+":{"+vals+"}";break}if(type!="object"&&type!="array")val+=";";return val}function unserialize(inp){error=0;if(inp==""||inp.length<2){errormsg="input is too short";return}var val,kret,vret,cval;var type=inp.charAt(0);var cont=inp.substring(2);var size=0,divpos=0,endcont=0,rest="",next="";switch(type){case"N":if(inp.charAt(1)!=";"){errormsg="missing ; for null"}rest=cont;break;case"b":if(!/[01];/.test(cont.substring(0,2))){errormsg="value not 0 or 1, or missing ; for boolean"}val=cont.charAt(0)=="1";rest=cont.substring(2);break;case"s":val="";divpos=cont.indexOf(":");if(divpos==-1){errormsg="missing : for string";break}size=parseInt(cont.substring(0,divpos));if(size==0){if(cont.length-divpos<4){errormsg="string is too short";break}rest=cont.substring(divpos+4);break}if(cont.length-divpos-size<4){errormsg="string is too short";break}if(cont.substring(divpos+2+size,divpos+4+size)!='";'){errormsg='string is too long, or missing ";'}val=cont.substring(divpos+2,divpos+2+size);rest=cont.substring(divpos+4+size);break;case"i":case"d":var dotfound=0;for(var i=0;i<cont.length;i++){cval=cont.charAt(i);if(isNaN(parseInt(cval))&&!(type=="d"&&cval=="."&&!dotfound++)){endcont=i;break}}if(!endcont||cont.charAt(endcont)!=";"){errormsg="missing or invalid value, or missing ; for int/float"}val=cont.substring(0,endcont);val=type=="i"?parseInt(val):parseFloat(val);rest=cont.substring(endcont+1);break;case"a":if(cont.length<4){errormsg="array is too short";return}divpos=cont.indexOf(":",1);if(divpos==-1){errormsg="missing : for array";return}size=parseInt(cont.substring(1*divpos,0));cont=cont.substring(divpos+2);val=[];if(cont.length<1){errormsg="array is too short";return}for(var i=0;i+1<size*2;i+=2){kret=unserialize(cont,1);if(error||kret[0]==undefined||kret[1]==undefined||kret[1]==""){errormsg="missing or invalid key, or missing value for array";return}vret=unserialize(kret[1],1);if(error){errormsg="invalid value for array";return}val[kret[0]]=vret[0];cont=vret[1]}if(cont.charAt(0)!="}"){errormsg="missing ending }, or too many values for array";return}rest=cont.substring(1);break;case"O":divpos=cont.indexOf(":");if(divpos==-1){errormsg="missing : for object";return}size=parseInt(cont.substring(0,divpos));var objname=cont.substring(divpos+2,divpos+2+size);if(cont.substring(divpos+2+size,divpos+4+size)!='":'){errormsg='object name is too long, or missing ":';return}var objprops=unserialize("a:"+cont.substring(divpos+4+size));if(error){errormsg="invalid object properties";return}val=new Object;for(key in objprops){if(typeof objprops[key]!="function"){val[key]=objprops[key]}}break;default:errormsg="invalid input type"}return arguments.length==1?val:[val,rest]}function getCities(state_id,instance_id,shipper_id,selected_city,shipping_only,pickup_point_only,return_func){if(state_id!=0){if(typeof shipper_id=="undefined"){shipper_id=0}if(typeof selected_city=="undefined"){selected_city=0}if(typeof shipping_only=="undefined"){shipping_only=true}if(typeof pickup_point_only=="undefined"){pickup_point_only=false}jQuery("#city"+instance_id).html("<option value='0'>"+_("Se incarca...")+"</option>");jQuery.ajax({url:"/ajax/cities?state="+state_id+"&shipper_id="+shipper_id+"&selected_city="+selected_city+"&shipping_only="+(shipping_only?1:0)+"&pickup_point_only="+(pickup_point_only?1:0),success:function(msg){jQuery("#city"+instance_id).html(msg);if(isID("city"+instance_id+"_chosen")){jQuery("#city"+instance_id).trigger("chosen:updated")}if(typeof return_func=="function"){return_func()}}})}}function getStates(country_id,current_state,instance_id,shipper_id,selected_city,shipping_only,pickup_point_only,return_func){if(country_id!=0){jQuery("#city"+instance_id).html('<option value="">--'+_("alegeti intai judetul")+"--</option>");jQuery("#state"+instance_id).html('<option value="">'+_("Se incarca...")+"</option>");if(typeof shipper_id=="undefined"){shipper_id=0}if(typeof selected_city=="undefined"){selected_city=0}if(typeof shipping_only=="undefined"){shipping_only=true}if(typeof pickup_point_only=="undefined"){pickup_point_only=false}if(typeof return_func=="undefined"){return_func=""}jQuery.ajax({url:"/ajax/states?country="+country_id+"&selected_state="+current_state+"&shipping_only="+(shipping_only?1:0),success:function(msg){jQuery("#state"+instance_id).html(msg);if(isID("cart_form")){if(!current_state&&jQuery("#state"+instance_id).children().length==2){state_id=jQuery("#state"+instance_id+" option:last-child").val();if(state_id){jQuery("#state"+instance_id).val(state_id);current_state=state_id}}if(selected_city){getCities(current_state,instance_id,shipper_id,selected_city,shipping_only,pickup_point_only,return_func)}}}})}}if(jQuery.fn.jqmHide){jQuery(document).keyup(function(e){if(isID("jwin")&&e.keyCode==27){jQuery("#jwin").jqmHide()}})}function isID(id){return document.getElementById(id)!==null}function htmlspecialchars(t){t=t.replace("/&/g","&amp;");t=t.replace("/</g","&lt;");t=t.replace("/>/g","&gt;");t=t.replace('/"/g',"&quot;");t=t.replace("/'/g","&#039;");return t}function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n)}function strpos(haystack,needle,offset){var i=(haystack+"").indexOf(needle,offset||0);return i===-1?false:i}var fileFieldCount=0;function addFileField(){var fields=jQuery("#attachments_fields");if(fields.children().length>=10){return false}fileFieldCount++;var s=fields.children("div").first().clone();s.children("input.file").attr("name","attachments["+fileFieldCount+"]").val("");s.children("input.description").attr("name","descriptions["+fileFieldCount+"]").val("");s.children("a.delete").show().removeClass("hidden");fields.append(s)}function removeFileField(el){var fields=jQuery("#attachments_fields");var s=jQuery(el).parents("div").first();if(fields.children().length>1){s.remove()}else{s.children("input.file").val("");s.children("input.description").val("")}}function gaq_fire_confirm(){jQuery.ajax({url:"/ajax/gaq_fire_confirm",success:function(){}})}function getLocation(){jQuery(document).ready(function(){if(navigator.geolocation&&!jQuery.cookie("geo_data")){navigator.geolocation.getCurrentPosition(function(result){jQuery.getJSON("https://maps.googleapis.com/maps/api/geocode/json?latlng="+result.coords.latitude+","+result.coords.longitude,function(data){if(typeof data.status!="undefined"&&data.status=="OK"&&typeof data.results[0]!="undefined"&&typeof data.results[0].address_components!="undefined"){var location_obj={city:"",state:"",country:"",country_code:"",address:data.results[0].formatted_address,latitude:result.coords.latitude,longitude:result.coords.longitude};jQuery.each(data.results[0].address_components,function(index,value){if(value.types){if(jQuery.inArray("locality",value.types)!=-1){location_obj.city=value.long_name}else if(jQuery.inArray("sublocality",value.types)!=-1){location_obj.state=value.long_name}else if(jQuery.inArray("country",value.types)!=-1){location_obj.country=value.long_name;location_obj.country_code=value.short_name}}});jQuery.cookie("geo_data",JSON.stringify(location_obj),{expires:7,path:"/",domain:cookie_domain,secure:is_ssl})}else{jQuery.cookie("geo_data","-",{expires:14,path:"/",domain:cookie_domain,secure:is_ssl})}})},function(msg){jQuery.cookie("geo_data","-",{expires:14,path:"/",domain:cookie_domain,secure:is_ssl})})}})}function getobjSize(obj){var count=0;if(typeof obj=="object"){if(Object.keys){count=Object.keys(obj).length}else if(window._){count=_.keys(obj).length}else if(window.$){count=$.map(obj,function(){return 1}).length}else{for(var key in obj)if(obj.hasOwnProperty(key))count++}}return count}function toggleCheckboxes(container_id){var checkBoxes=$("#"+container_id+" input[type=checkbox]:not(.ignoreSelection)");checkBoxes.prop("checked",!checkBoxes.prop("checked"))}function checkNewLead(email,telephone,source){if(typeof email=="undefined"||email===null){email=isID("new_email")?$("#new_email").val():isID("customer_email")?$("#customer_email").val():""}if(typeof telephone=="undefined"||telephone===null){telephone=isID("new_telephone")?$("#new_telephone").val():isID("customer_telephone")?$("#customer_telephone").val():""}let firstname=isID("new_firstname")?$("#new_firstname").val():"";let lastname=isID("new_lastname")?$("#new_lastname").val():"";let name=isID("new_name")?$("#new_name").val():isID("customer_name")?$("#customer_name").val():"";if(email&&validEmail(email)||telephone&&validTelephone(telephone)){$.ajax({url:"/ajax/check_new_lead?source="+encodeURIComponent(source)+"&email="+encodeURIComponent(email)+"&telephone="+encodeURIComponent(telephone)+"&firstname="+encodeURIComponent(firstname)+"&lastname="+encodeURIComponent(lastname)+"&name="+encodeURIComponent(name),success:function(msg){if(source=="checkout"){if(msg==""){$("#new_email_label").removeClass("cherror");$("#new_customer_title").removeClass("cherror");$("#new_customer_title span").html("")}else{$("#new_email_label").addClass("cherror");$("#new_customer_title").addClass("cherror");$("#new_customer_title span").html("("+msg+")")}}}})}}function padTo2Digits(num){return num.toString().padStart(2,"0")}function formatDate(date){return[date.getFullYear(),padTo2Digits(date.getMonth()+1),padTo2Digits(date.getDate())].join("-")+" "+[padTo2Digits(date.getHours()),padTo2Digits(date.getMinutes()),padTo2Digits(date.getSeconds())].join(":")}